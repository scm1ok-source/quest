<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ö–≤–µ—Å—Ç—ã –ø–æ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—É ‚Äî –°—Ç–∞—Ä—Ç</title>
  <style>
    :root{
      --bg:#ffffff; --panel:#ffffff; --text:#0f172a; --muted:#475569; --line:#e2e8f0;
      --brand:#2563eb; --brand-2:#06b6d4; --ok:#16a34a; --warn:#d97706;
      --radius:18px; --shadow:0 10px 30px rgba(2,6,23,.08); --w: 1060px;
    }
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);
      font:18px/1.7 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Inter,Arial,sans-serif;
      -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
    a{color:#1d4ed8;text-decoration:none}
    .doc{max-width:var(--w);margin:42px auto 120px;padding:0 22px}
    .hero{background:radial-gradient(1200px 500px at 50% -160px, rgba(37,99,235,.08), transparent 60%);
      padding:22px 0 10px;margin-bottom:16px}
    .title{font-size:clamp(34px,5vw,56px);font-weight:800;margin:0 0 8px}
    .subtitle{color:var(--muted);font-size:18px;margin:0 0 18px}

    .grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:18px}
    @media (max-width:900px){.grid{grid-template-columns:1fr}}

    .card{background:var(--panel);border:1px solid var(--line);border-radius:var(--radius);
      padding:20px 18px;box-shadow:var(--shadow);display:flex;flex-direction:column;gap:10px}
    .card h3{margin:0;font-size:22px}
    .desc{color:var(--muted);margin:0}

    .tags{display:flex;gap:8px;flex-wrap:wrap}
    .tag{font-size:13px;color:#0b3a8a;background:#eef2ff;border:1px solid #dbeafe;border-radius:999px;padding:4px 10px}
    .muted{color:var(--muted)}

    .progress{width:100%;height:10px;border-radius:999px;background:#f1f5f9;border:1px solid var(--line);overflow:hidden}
    .progress>span{display:block;height:100%;width:0%;background:linear-gradient(90deg,var(--brand),var(--brand-2));transition:width .35s ease}

    .row{display:flex;align-items:center;justify-content:space-between;gap:10px}
    .btn{display:inline-flex;align-items:center;gap:10px;padding:10px 14px;border-radius:14px;
      border:1px solid rgba(37,99,235,.35);background:rgba(37,99,235,.08);color:var(--text);font-weight:700}
    .btn:hover{transform:translateY(-1px);background:rgba(37,99,235,.12);border-color:rgba(37,99,235,.55)}
    .btn.ok{background:var(--ok);border-color:var(--ok);color:#fff}
    .btn.warn{background:#fef3c7;border-color:#fde68a}
    .btn.ghost{background:#f8fafc;border-color:var(--line);color:var(--muted);font-weight:600}

    .footer-actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:20px}
    .big-progress{margin:24px 0 8px}
  </style>
</head>
<body>
  <header class="hero">
    <div class="doc">
      <h1 class="title">–ö–≤–µ—Å—Ç—ã –ø–æ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—É</h1>
      <p class="subtitle">–°—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω ‚Ä¢ –≤—ã–±–∏—Ä–∞–π—Ç–µ –ª—é–±–æ–π —à–∞–≥ –∏–ª–∏ –ø—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ —Å –º–µ—Å—Ç–∞, –≥–¥–µ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª–∏—Å—å</p>
    </div>
  </header>

  <main class="doc">
    <!-- –û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å -->
    <section class="card">
      <div class="row">
        <h3>–û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å</h3>
        <strong id="total-label" class="muted">0% –≤—ã–ø–æ–ª–Ω–µ–Ω–æ</strong>
      </div>
      <div class="progress big-progress"><span id="total-bar"></span></div>
      <div class="footer-actions">
        <a id="continue-btn" class="btn ok" href="step1.html">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</a>
        <button id="reset-btn" class="btn ghost" type="button">–°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å</button>
      </div>
    </section>

    <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ —à–∞–≥–æ–≤ -->
    <section class="grid" style="margin-top:18px">
      <!-- Step 1 -->
      <article class="card" data-step="1">
        <h3>Step 1 ‚Äî –ü–µ—Ä–µ–∫–æ–¥–∏—Ä–æ–≤–∫–∞ —á–µ—Ä–µ–∑ –∞—Ç—Ä–∏–±—É—Ç—ã</h3>
        <p class="desc">–ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ —Å–ø–∏—Å–æ–∫, –∑–∞–¥–∞–π—Ç–µ –∞—Ç—Ä–∏–±—É—Ç <code>new</code>, –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ <em>Recode by attribute</em>.</p>
        <div class="tags">
          <span class="tag">Raw</span><span class="tag">Attribute</span><span class="tag">Recode</span>
        </div>
        <div class="row">
          <div class="progress" style="flex:1"><span id="bar-1"></span></div>
          <span id="label-1" class="muted" style="min-width:64px;text-align:right">0%</span>
        </div>
        <div class="row">
          <a class="btn" href="step1.html">–û—Ç–∫—Ä—ã—Ç—å</a>
          <a class="btn ghost" href="step1.html#checklist">–ö —á–µ–∫-–ª–∏—Å—Ç—É</a>
        </div>
      </article>

      <!-- Step 2 -->
      <article class="card" data-step="2">
        <h3>Step 2 ‚Äî –ß–∏—Å–ª–æ ‚Üí –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</h3>
        <p class="desc">–°–æ–∑–¥–∞–π—Ç–µ <code>q3</code> (—á–∏—Å–ª–æ–≤–æ–π) –∏ <code>q4</code> (–∫–∞—Ç–µ–≥–æ—Ä–∏–∏), –∑–∞–¥–∞–π—Ç–µ <code>min/max</code> –≥—Ä–∞–Ω–∏—Ü—ã.</p>
        <div class="tags">
          <span class="tag">Numeric</span><span class="tag">min/max</span><span class="tag">Mapping</span>
        </div>
        <div class="row">
          <div class="progress" style="flex:1"><span id="bar-2"></span></div>
          <span id="label-2" class="muted" style="min-width:64px;text-align:right">0%</span>
        </div>
        <div class="row">
          <a class="btn" href="step2.html">–û—Ç–∫—Ä—ã—Ç—å</a>
          <a class="btn ghost" href="step2.html#checklist">–ö —á–µ–∫-–ª–∏—Å—Ç—É</a>
        </div>
      </article>

      <!-- Step 3 -->
      <article class="card" data-step="3">
        <h3>Step 3 ‚Äî –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Å–ø–∏—Å–∫–∏</h3>
        <p class="desc">–°–∫—Ä—ã—Ç–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è + <code>SET</code> ‚Üí —Ä–∞–∑–Ω—ã–µ —Å–ø–∏—Å–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç <code>q4</code>.</p>
        <div class="tags">
          <span class="tag">Hidden var</span><span class="tag">SET</span><span class="tag">Dynamic options</span>
        </div>
        <div class="row">
          <div class="progress" style="flex:1"><span id="bar-3"></span></div>
          <span id="label-3" class="muted" style="min-width:64px;text-align:right">0%</span>
        </div>
        <div class="row">
          <a class="btn" href="step3.html">–û—Ç–∫—Ä—ã—Ç—å</a>
          <a class="btn ghost" href="step3.html#checklist">–ö —á–µ–∫-–ª–∏—Å—Ç—É</a>
        </div>
      </article>

      <!-- Step 4 -->
      <article class="card" data-step="4">
        <h3>Step 4 ‚Äî –§–∏–ª—å—Ç—Ä—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã</h3>
        <p class="desc">–ö–æ–º–∞–Ω–¥–∞ <code>ASK</code> + —É—Å–ª–æ–≤–∏–µ <code>IF</code> ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–æ–ø—Ä–æ—Å —Ç–æ–ª—å–∫–æ —Ü–µ–ª–µ–≤–æ–π –≥—Ä—É–ø–ø–µ.</p>
        <div class="tags">
          <span class="tag">ASK</span><span class="tag">IF</span><span class="tag">Filter</span>
        </div>
        <div class="row">
          <div class="progress" style="flex:1"><span id="bar-4"></span></div>
          <span id="label-4" class="muted" style="min-width:64px;text-align:right">0%</span>
        </div>
        <div class="row">
          <a class="btn" href="step4.html">–û—Ç–∫—Ä—ã—Ç—å</a>
          <a class="btn ghost" href="step4.html#checklist">–ö —á–µ–∫-–ª–∏—Å—Ç—É</a>
        </div>
      </article>
    </section>

    <!-- –§–∏–Ω–∞–ª -->
    <section class="card" style="margin-top:18px">
      <div class="row">
        <h3>–§–∏–Ω–∞–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω</h3>
        <span id="finish-status" class="muted">–¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ—Å–ª–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤</span>
      </div>
      <div class="row">
        <a id="finish-link" class="btn warn" href="finish.html">–û—Ç–∫—Ä—ã—Ç—å —Ñ–∏–Ω–∞–ª</a>
        <span class="muted">–ü–æ–¥—Å–∫–∞–∑–∫–∞: –º–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å –∏ —Å–µ–π—á–∞—Å, –Ω–æ –ª—É—á—à–µ –∑–∞–≤–µ—Ä—à–∏—Ç—å –≤—Å–µ —à–∞–≥–∏ üòä</span>
      </div>
    </section>
  </main>

  <script>
  (function(){
    // –ö–ª—é—á–∏, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ —à–∞–≥–∞—Ö:
    const KEYS = {
      1: 'quest_step1_checks_all_v2',
      2: 'quest_step2_checks',
      3: 'quest_step3_checks',
      4: 'quest_step4_checks'
    };

    // –°–∫–æ–ª—å–∫–æ —á–µ–∫–±–æ–∫—Å–æ–≤ –æ–∂–∏–¥–∞–µ—Ç—Å—è –≤ –∫–∞–∂–¥–æ–º —à–∞–≥–µ (—á—Ç–æ–±—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å—á–∏—Ç–∞—Ç—å %, –µ—Å–ª–∏ localStorage –ø—É—Å—Ç)
    // –ï—Å–ª–∏ –Ω–µ —É–≤–µ—Ä–µ–Ω—ã ‚Äî –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å 0, —Ç–æ–≥–¥–∞ % –≤–æ–∑—å–º—ë–º –∏–∑ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π –¥–ª–∏–Ω—ã –º–∞—Å—Å–∏–≤–∞.
    const EXPECTED = {
      1: 5, // –∏—Ç–æ–≥–æ–≤—ã–π —á–µ–∫-–ª–∏—Å—Ç –Ω–∞ step1
      2: 4,
      3: 3,
      4: 3
    };

    const qs = (s,el=document)=>el.querySelector(s);
    const qsa= (s,el=document)=>Array.from(el.querySelectorAll(s));

   function readProgress(key, expected){
  try{
    const saved = JSON.parse(localStorage.getItem(key) || '[]');
    const done  = saved.filter(v => !!v).length;
    const total = Math.max(expected || 0, saved.length);
    if (!total) return 0;
    return Math.min(100, Math.round(done / total * 100));
  }catch(e){
    return 0;
  }
}


    function setBar(step, pct){
      const bar = qs('#bar-'+step);
      const label = qs('#label-'+step);
      if (bar) bar.style.width = pct + '%';
      if (label) label.textContent = pct + '%';
    }

    function compute(){
      // step bars
      const p1 = readProgress(KEYS[1], EXPECTED[1]);
      const p2 = readProgress(KEYS[2], EXPECTED[2]);
      const p3 = readProgress(KEYS[3], EXPECTED[3]);
      const p4 = readProgress(KEYS[4], EXPECTED[4]);

      setBar(1,p1); setBar(2,p2); setBar(3,p3); setBar(4,p4);

      // total
      const totalBar = qs('#total-bar');
      const totalLabel = qs('#total-label');
      const avg = Math.round((p1 + p2 + p3 + p4) / 4);
      if (totalBar) totalBar.style.width = avg + '%';
      if (totalLabel) totalLabel.textContent = avg + '% –≤—ã–ø–æ–ª–Ω–µ–Ω–æ';

      // continue button ‚Äî –Ω–∞ –ø–µ—Ä–≤—ã–π –Ω–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–π —à–∞–≥
      const continueBtn = qs('#continue-btn');
      if (continueBtn){
        if (p1 < 100) continueBtn.href = 'step1.html';
        else if (p2 < 100) continueBtn.href = 'step2.html';
        else if (p3 < 100) continueBtn.href = 'step3.html';
        else if (p4 < 100) continueBtn.href = 'step4.html';
        else continueBtn.href = 'finish.html';
      }

      // finish hint
      const finishStatus = qs('#finish-status');
      if (finishStatus){
        finishStatus.textContent = (p1===100 && p2===100 && p3===100 && p4===100)
          ? '–≤—Å–µ —à–∞–≥–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã ‚Äî –º–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å —Ñ–∏–Ω–∞–ª üéâ'
          : '–¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ—Å–ª–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤';
      }
    }

    // Reset
    function reset(){
      Object.values(KEYS).forEach(k => localStorage.removeItem(k));
      compute();
    }

    // UI wire
    document.addEventListener('DOMContentLoaded', ()=>{
      compute();
      const resetBtn = qs('#reset-btn');
      if (resetBtn) resetBtn.addEventListener('click', reset);
    });
  })();
  </script>
</body>
</html>
